-- ================================================
-- üïµÔ∏è‚Äç‚ôÇÔ∏è –ù–ï–í–ò–î–ò–ú–´–ô HTTP SPY (–¢–û–õ–¨–ö–û –§–ê–ô–õ–û–í–´–ï –õ–û–ì–ò)
-- ================================================

-- 1. –°–∫—Ä—ã—Ç–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
local SECURE_STORAGE = {
    LOADSTRING = loadstring,
    HTTPGET = game.HttpGet,
    HTTPPOST = game.HttpPost,
    GETASYNC = game:GetService("HttpService").GetAsync,
    POSTASYNC = game:GetService("HttpService").PostAsync
}

-- 2. –§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª
local function WriteToLog(reqType, url, data)
    local logEntry = os.date("[%H:%M:%S]")
    
    if reqType == "LOADSTRING" then
        logEntry = logEntry.." [LOADSTRING] üîó "..url
    elseif reqType:find("GET") then
        logEntry = logEntry.." ["..reqType.."] üåê "..url
    elseif reqType:find("POST") then
        logEntry = logEntry.." ["..reqType.."] üì§ "..url.." | üìù "..tostring(data):sub(1, 100)
    end

    pcall(function()
        appendfile("http_spy_ultra.txt", logEntry.."\n")
    end)
end

-- 3. –ü–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–∏ (–±–µ–∑ –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å)
-- Loadstring
loadstring = function(code, ...)
    for url in code:gmatch("https?://[%w-_%.%?%.:/%+=&]+") do
        WriteToLog("LOADSTRING", url)
    end
    return SECURE_STORAGE.LOADSTRING(code, ...)
end

-- HttpGet
game.HttpGet = function(self, url, ...)
    WriteToLog("HTTP-GET", url)
    return SECURE_STORAGE.HTTPGET(self, url, ...)
end

-- HttpPost
game.HttpPost = function(self, url, data, ...)
    WriteToLog("HTTP-POST", url, data)
    return SECURE_STORAGE.HTTPPOST(self, url, data, ...)
end

-- HttpService
local HttpService = game:GetService("HttpService")
HttpService.GetAsync = function(self, url, ...)
    WriteToLog("HTTPSERVICE-GET", url)
    return SECURE_STORAGE.GETASYNC(self, url, ...)
end

HttpService.PostAsync = function(self, url, data, ...)
    WriteToLog("HTTPSERVICE-POST", url, data)
    return SECURE_STORAGE.POSTASYNC(self, url, data, ...)
end

-- 4. –ó–∞—â–∏—Ç–∞ –æ—Ç –∞–Ω—Ç–∏—á–∏—Ç–æ–≤ (—Ç–∏—Ö–∏–π —Ä–µ–∂–∏–º)
task.spawn(function()
    while task.wait(3) do
        pcall(function()
            _G.print = function() end
            _G.warn = function() end
        end)
    end
end)

-- 5. –ü–µ—Ä–µ—Ö–≤–∞—Ç syn.request (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
if syn and syn.request and not SECURE_STORAGE.SYNREQUEST then
    SECURE_STORAGE.SYNREQUEST = syn.request
    syn.request = function(args)
        WriteToLog("SYN-"..(args.Method or "GET"), args.Url, args.Body)
        return SECURE_STORAGE.SYNREQUEST(args)
    end
end
